[ {
  "active" : true,
  "code" : "mv-ticket-management",
  "description" : "Trouble ticket management system",
  "license" : "GPL",
  "script" : {
    "active" : true,
    "code" : "org.meveo.ticket_management.TicketManagementInstallScript",
    "inputs" : [ ],
    "outputs" : [ ],
    "generateOutputs" : false,
    "type" : "JAVA",
    "transactionType" : "SAME",
    "script" : "package org.meveo.ticket_management;\r\n\r\nimport java.io.File;\r\nimport java.io.FileOutputStream;\r\nimport java.io.InputStream;\r\nimport java.io.OutputStream;\r\nimport java.util.Map;\r\n\r\nimport javax.ws.rs.client.Client;\r\nimport javax.ws.rs.client.ClientBuilder;\r\nimport javax.ws.rs.client.WebTarget;\r\nimport javax.ws.rs.core.Response;\r\n\r\nimport org.meveo.admin.exception.BusinessException;\r\nimport org.meveo.service.config.impl.MavenConfigurationService;\r\nimport org.meveo.service.script.module.ModuleScript;\r\n\r\npublic class TicketManagementInstallScript extends ModuleScript {\r\n    \r\n    static final String REPO_NAME=\"smichea\";\r\n    static final String GROUP_ID=\"com.assembla\";\r\n    static final String ARTIFACT_ID=\"assembla-api\";\r\n    static final String VERSION=\"0.1\";\r\n    static final String CLASSIFIER=\"\";\r\n    static final String FILENAME = \"assembla-api-0.1.jar\";\r\n\r\n    MavenConfigurationService mavenConfigurationService = getCDIBean(MavenConfigurationService.class);\r\n\r\n    protected InputStream  downloadJar(){\r\n        Client client = ClientBuilder.newClient();\r\n        WebTarget webTarget = client.target(\"https://github.com/\"+REPO_NAME+\"/\"+ARTIFACT_ID+\"/releases/download/v\"+VERSION+\"/\"+FILENAME);\r\n        Response response = webTarget.request().get();\r\n        if(response.getStatus()==302){\r\n            String location = response.getHeaderString(\"Location\");\r\n            response = client.target(location).request().get();\r\n        }\r\n        if(response.getStatus()==200){\r\n            InputStream in = response.readEntity(InputStream.class);\r\n            return in;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    protected void uploadMavenArtifact(InputStream inputStream, File file) throws BusinessException{\r\n\t\ttry {\r\n\t\t\tOutputStream outputStream = new FileOutputStream(file);\r\n\t\t\tint read = 0;\r\n\t\t\tbyte[] data = new byte[1024];\r\n\r\n\t\t\twhile ((read = inputStream.read(data)) != -1) {\r\n\t\t\t\toutputStream.write(data, 0, read);\r\n\t\t\t}\r\n\r\n\t\t\tinputStream.close();\r\n\t\t\toutputStream.flush();\r\n\t\t\toutputStream.close();\r\n\r\n\t\t} catch (Exception e) {\r\n\t\t\tthrow new BusinessException(\"Error uploading file: \" + FILENAME + \". \" + e.getMessage());\r\n\t\t}\r\n\t}\r\n    \r\n    protected boolean artifactExist(){\r\n        boolean result=false;\r\n        return result;\r\n    }\r\n\r\n    protected void updloadArtifact() throws BusinessException{\r\n        String filePath = mavenConfigurationService.createDirectory(GROUP_ID, ARTIFACT_ID, VERSION, CLASSIFIER);\r\n\t\tfilePath = filePath + File.separator + mavenConfigurationService.buildArtifactName(ARTIFACT_ID, VERSION, CLASSIFIER);\r\n        File file =new File(filePath);\r\n        if(!file.exists()){\r\n            InputStream in = downloadJar();\r\n            uploadMavenArtifact(in,file);\r\n        }\r\n    }\r\n\r\n    public void preInstallModule(Map<String, Object> methodContext) throws BusinessException {\r\n        updloadArtifact();\r\n    }\r\n\r\n    public void execute(Map<String, Object> methodContext) throws BusinessException {\r\n        updloadArtifact();\r\n    }\r\n}\r\n",
    "executionRoles" : [ ],
    "sourcingRoles" : [ ],
    "mavenDependencies" : [ ],
    "importScriptInstances" : [ ]
  },
  "currentVersion" : "0.1",
  "meveoVersionBase" : "6.14.0",
  "transient" : true,
  "codeOnly" : false,
  "inDraft" : true,
  "moduleItems" : [ {
    "dtoClassName" : "org.meveo.api.dto.CustomEntityTemplateDto",
    "dtoData" : {
      "code" : "MV_TCKTMNG_TICKET",
      "name" : "Ticket",
      "description" : "Ticket describing an issue, a feature, a task...",
      "customEntityCategoryCode" : "PROJECTS",
      "availableStorages" : [ "SQL" ],
      "sqlStorageConfiguration" : {
        "storeAsTable" : true
      },
      "samples" : [ ],
      "audited" : false,
      "fields" : [ {
        "code" : "assignees",
        "description" : "Assignees",
        "fieldType" : "STRING",
        "accountLevel" : "CE_MV_TCKTMNG_TICKET",
        "appliesTo" : "CE_MV_TCKTMNG_TICKET",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "LIST",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 50,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Ticket:0;field:6",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : true,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "closedAt",
        "description" : "Closed date",
        "fieldType" : "DATE",
        "accountLevel" : "CE_MV_TCKTMNG_TICKET",
        "appliesTo" : "CE_MV_TCKTMNG_TICKET",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : false,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Ticket:0;field:9",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : true,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "comments",
        "description" : "Comments",
        "fieldType" : "CHILD_ENTITY",
        "accountLevel" : "CE_MV_TCKTMNG_TICKET",
        "appliesTo" : "CE_MV_TCKTMNG_TICKET",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "LIST",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "entityClazz" : "org.meveo.model.customEntities.CustomEntityTemplate - MV_TCKTMNG_COMMENT",
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Ticket:0;field:11",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "entityClazzCetCode" : "MV_TCKTMNG_COMMENT",
        "unique" : false,
        "matrixColumns" : [ ],
        "childEntityFieldsForSummary" : [ "createdAt", "creator", "description", "updatedAt" ]
      }, {
        "code" : "createdAt",
        "description" : "Creation date",
        "fieldType" : "DATE",
        "accountLevel" : "CE_MV_TCKTMNG_TICKET",
        "appliesTo" : "CE_MV_TCKTMNG_TICKET",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : false,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Ticket:0;field:7",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "creator",
        "description" : "Creator",
        "fieldType" : "STRING",
        "accountLevel" : "CE_MV_TCKTMNG_TICKET",
        "appliesTo" : "CE_MV_TCKTMNG_TICKET",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 50,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Ticket:0;field:4",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : true,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "description",
        "description" : "Description",
        "fieldType" : "TEXT_AREA",
        "accountLevel" : "CE_MV_TCKTMNG_TICKET",
        "appliesTo" : "CE_MV_TCKTMNG_TICKET",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Ticket:0;field:3",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : true,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "milestone",
        "description" : "Milestone",
        "fieldType" : "ENTITY",
        "accountLevel" : "CE_MV_TCKTMNG_TICKET",
        "appliesTo" : "CE_MV_TCKTMNG_TICKET",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "entityClazz" : "org.meveo.model.customEntities.CustomEntityTemplate - MV_TCKTMNG_MILESTONE",
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Ticket:0;field:10",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "entityClazzCetCode" : "MV_TCKTMNG_MILESTONE",
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "number",
        "description" : "Number",
        "fieldType" : "LONG",
        "accountLevel" : "CE_MV_TCKTMNG_TICKET",
        "appliesTo" : "CE_MV_TCKTMNG_TICKET",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : false,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Ticket:0;field:1",
        "identifier" : true,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "project",
        "description" : "Project",
        "fieldType" : "ENTITY",
        "accountLevel" : "CE_MV_TCKTMNG_TICKET",
        "appliesTo" : "CE_MV_TCKTMNG_TICKET",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "entityClazz" : "org.meveo.model.customEntities.CustomEntityTemplate - MV_TCKTMNG_PROJECT",
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Ticket:0;field:0",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "entityClazzCetCode" : "MV_TCKTMNG_PROJECT",
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "tags",
        "description" : "Tags",
        "fieldType" : "STRING",
        "accountLevel" : "CE_MV_TCKTMNG_TICKET",
        "appliesTo" : "CE_MV_TCKTMNG_TICKET",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "LIST",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 50,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Ticket:0;field:5",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "title",
        "description" : "Title",
        "fieldType" : "STRING",
        "accountLevel" : "CE_MV_TCKTMNG_TICKET",
        "appliesTo" : "CE_MV_TCKTMNG_TICKET",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 250,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Ticket:0;field:2",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : true,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "updatedAt",
        "description" : "last update",
        "fieldType" : "DATE",
        "accountLevel" : "CE_MV_TCKTMNG_TICKET",
        "appliesTo" : "CE_MV_TCKTMNG_TICKET",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Ticket:0;field:8",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      } ],
      "actions" : [ ]
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.CustomEntityTemplateDto",
    "dtoData" : {
      "code" : "MV_TCKTMNG_MILESTONE",
      "name" : "Milestones",
      "description" : "Milestones",
      "customEntityCategoryCode" : "PROJECTS",
      "availableStorages" : [ "SQL" ],
      "sqlStorageConfiguration" : {
        "storeAsTable" : true
      },
      "samples" : [ ],
      "audited" : false,
      "fields" : [ {
        "code" : "description",
        "description" : "Description",
        "fieldType" : "TEXT_AREA",
        "accountLevel" : "CE_MV_TCKTMNG_MILESTONE",
        "appliesTo" : "CE_MV_TCKTMNG_MILESTONE",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Milestones:0;field:2",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "dueDate",
        "description" : "Due date",
        "fieldType" : "DATE",
        "accountLevel" : "CE_MV_TCKTMNG_MILESTONE",
        "appliesTo" : "CE_MV_TCKTMNG_MILESTONE",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Milestones:0;field:4",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "endDate",
        "description" : "End date",
        "fieldType" : "DATE",
        "accountLevel" : "CE_MV_TCKTMNG_MILESTONE",
        "appliesTo" : "CE_MV_TCKTMNG_MILESTONE",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Milestones:0;field:5",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "project",
        "description" : "Project",
        "fieldType" : "ENTITY",
        "accountLevel" : "CE_MV_TCKTMNG_MILESTONE",
        "appliesTo" : "CE_MV_TCKTMNG_MILESTONE",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "entityClazz" : "org.meveo.model.customEntities.CustomEntityTemplate - MV_TCKTMNG_PROJECT",
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Milestones:0;field:0",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "entityClazzCetCode" : "MV_TCKTMNG_PROJECT",
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "remoteId",
        "description" : "Remote Id",
        "fieldType" : "STRING",
        "accountLevel" : "CE_MV_TCKTMNG_MILESTONE",
        "appliesTo" : "CE_MV_TCKTMNG_MILESTONE",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 255,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Milestones:0;field:6",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "startDate",
        "description" : "Start date",
        "fieldType" : "DATE",
        "accountLevel" : "CE_MV_TCKTMNG_MILESTONE",
        "appliesTo" : "CE_MV_TCKTMNG_MILESTONE",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Milestones:0;field:3",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "title",
        "description" : "Title",
        "fieldType" : "STRING",
        "accountLevel" : "CE_MV_TCKTMNG_MILESTONE",
        "appliesTo" : "CE_MV_TCKTMNG_MILESTONE",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 255,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Milestones:0;field:1",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      } ],
      "actions" : [ ]
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.CustomEntityTemplateDto",
    "dtoData" : {
      "code" : "MV_TCKTMNG_COMMENT",
      "name" : "Comment",
      "description" : "Comment",
      "customEntityCategoryCode" : "PROJECTS",
      "availableStorages" : [ ],
      "sqlStorageConfiguration" : {
        "storeAsTable" : true
      },
      "samples" : [ ],
      "audited" : false,
      "fields" : [ {
        "code" : "createdAt",
        "description" : "Creation date",
        "fieldType" : "DATE",
        "accountLevel" : "CE_MV_TCKTMNG_COMMENT",
        "appliesTo" : "CE_MV_TCKTMNG_COMMENT",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : false,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Comments:0;field:2",
        "identifier" : false,
        "storages" : [ ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "creator",
        "description" : "Creator",
        "fieldType" : "STRING",
        "accountLevel" : "CE_MV_TCKTMNG_COMMENT",
        "appliesTo" : "CE_MV_TCKTMNG_COMMENT",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : false,
        "hideOnNew" : false,
        "maxValue" : 50,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Comments:0;field:1",
        "identifier" : false,
        "storages" : [ ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "description",
        "description" : "Description",
        "fieldType" : "TEXT_AREA",
        "accountLevel" : "CE_MV_TCKTMNG_COMMENT",
        "appliesTo" : "CE_MV_TCKTMNG_COMMENT",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Comments:0;field:0",
        "identifier" : false,
        "storages" : [ ],
        "samples" : [ ],
        "summary" : false,
        "audited" : true,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "updatedAt",
        "description" : "Last update",
        "fieldType" : "DATE",
        "accountLevel" : "CE_MV_TCKTMNG_COMMENT",
        "appliesTo" : "CE_MV_TCKTMNG_COMMENT",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Comments:0;field:3",
        "identifier" : false,
        "storages" : [ ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      } ],
      "actions" : [ ]
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.CustomEntityCategoryDto",
    "dtoData" : {
      "code" : "PROJECTS",
      "name" : "Projects"
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.CustomEntityTemplateDto",
    "dtoData" : {
      "code" : "MV_TCKTMNG_PROJECT",
      "name" : "Project",
      "description" : "Project",
      "customEntityCategoryCode" : "PROJECTS",
      "availableStorages" : [ "SQL" ],
      "sqlStorageConfiguration" : {
        "storeAsTable" : true
      },
      "samples" : [ ],
      "audited" : false,
      "fields" : [ {
        "code" : "description",
        "description" : "Description",
        "fieldType" : "TEXT_AREA",
        "accountLevel" : "CE_MV_TCKTMNG_PROJECT",
        "appliesTo" : "CE_MV_TCKTMNG_PROJECT",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Project:0;field:1",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : false,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "name",
        "description" : "Name",
        "fieldType" : "STRING",
        "accountLevel" : "CE_MV_TCKTMNG_PROJECT",
        "appliesTo" : "CE_MV_TCKTMNG_PROJECT",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "SINGLE",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 255,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Project:0;field:0",
        "identifier" : false,
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      }, {
        "code" : "remoteSpaces",
        "description" : "Remote spaces (domain,name)_",
        "fieldType" : "STRING",
        "accountLevel" : "CE_MV_TCKTMNG_PROJECT",
        "appliesTo" : "CE_MV_TCKTMNG_PROJECT",
        "useInheritedAsDefaultValue" : false,
        "storageType" : "MAP",
        "valueRequired" : false,
        "versionable" : false,
        "triggerEndPeriodEvent" : false,
        "listValues" : { },
        "allowEdit" : true,
        "hideOnNew" : false,
        "maxValue" : 255,
        "contentTypes" : [ ],
        "fileExtensions" : [ ],
        "saveOnExplorer" : false,
        "guiPosition" : "tab:Project:0;field:2",
        "identifier" : false,
        "mapKeyType" : "STRING",
        "storages" : [ "SQL" ],
        "samples" : [ ],
        "summary" : true,
        "audited" : false,
        "persisted" : true,
        "filter" : false,
        "unique" : false,
        "matrixColumns" : [ ]
      } ],
      "actions" : [ {
        "code" : "RETRIEVE_REMOTE_TICKETS",
        "description" : "retreive tickets from remote spaces",
        "appliesTo" : "CE_MV_TCKTMNG_PROJECT",
        "label" : "Retrieve tickets",
        "script" : "org.meveo.ticket_management.RetrieveRemoteTicketsScript",
        "applicableToEntityList" : false,
        "applicableToEntityInstance" : true
      } ]
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.ScriptInstanceDto",
    "dtoData" : {
      "active" : true,
      "code" : "org.meveo.ticket_management.RetrieveRemoteTicketsScript",
      "inputs" : [ ],
      "outputs" : [ ],
      "generateOutputs" : false,
      "type" : "JAVA",
      "transactionType" : "SAME",
      "script" : "package org.meveo.ticket_management;\r\n\r\nimport java.util.Map;\r\nimport java.time.ZoneOffset;\r\nimport java.util.Collection;\r\nimport java.util.HashMap;\r\nimport java.util.List;\r\nimport javax.inject.Inject;\r\nimport javax.enterprise.inject.Instance;\r\nimport org.meveo.service.script.Script;\r\nimport org.slf4j.Logger;\r\nimport org.slf4j.LoggerFactory;\r\nimport org.meveo.model.customEntities.CustomEntityInstance;\r\nimport org.meveo.model.persistence.CEIUtils;\r\n\r\nimport org.meveo.model.customEntities.MV_TCKTMNG_TICKET;\r\nimport org.meveo.model.customEntities.MV_TCKTMNG_COMMENT;\r\nimport org.meveo.model.customEntities.MV_TCKTMNG_MILESTONE;\r\nimport org.meveo.model.customEntities.MV_TCKTMNG_PROJECT;\r\n\r\nimport org.meveo.model.customEntities.CREDENTIAL;\r\nimport org.meveo.admin.exception.BusinessException;\r\nimport org.meveo.model.storage.Repository;\r\nimport org.meveo.service.storage.RepositoryService;\r\nimport org.meveo.api.persistence.CrossStorageApi;\r\n\r\nimport com.assembla.Milestone;\r\nimport com.assembla.Ticket;\r\nimport com.assembla.client.AssemblaAPI;\r\nimport com.assembla.client.AssemblaResource;\r\nimport com.assembla.client.PagedIterator;\r\n\r\n\r\npublic class RetrieveRemoteTicketsScript extends Script {\r\n\r\n    private static final Logger log = LoggerFactory.getLogger(RetrieveRemoteTicketsScript.class);\r\n    \r\n  \t@Inject\r\n    private CrossStorageApi crossStorageApi;\r\n\t\r\n    @Inject\r\n  \tprivate RepositoryService repositoryService;\r\n  \r\n    \r\n    private CREDENTIAL getCredential(String domain){\r\n      List<CREDENTIAL> matchingCredentials = crossStorageApi.find(repositoryService.findDefaultRepository(), CREDENTIAL.class)\r\n                .by(\"DOMAIN\", domain)\r\n\t\t\t\t.getResults();\r\n      if(matchingCredentials.size()>0){\r\n        return matchingCredentials.get(0);\r\n      } else {\r\n        return null;\r\n      }\r\n    }\r\n\r\n    private MV_TCKTMNG_MILESTONE getMilestone(String remoteId){\r\n      MV_TCKTMNG_MILESTONE result=null;\r\n      List<MV_TCKTMNG_MILESTONE> matchingMilestones = crossStorageApi.find(repositoryService.findDefaultRepository(), MV_TCKTMNG_MILESTONE.class)\r\n                .by(\"remoteId\", remoteId)\r\n\t\t\t\t.getResults();\r\n      if(matchingMilestones.size()>0){\r\n        result = matchingMilestones.get(0);\r\n      } else {\r\n        result =  new MV_TCKTMNG_MILESTONE();\r\n        result.setRemoteId(remoteId);\r\n      }\r\n      return result;\r\n    }\r\n\r\n    public void retrieveAssemblaTickets(String spaceName)  throws BusinessException {\r\n    }\r\n\r\n    public void retrieveAssemblaTickets(MV_TCKTMNG_PROJECT project)  throws BusinessException {\r\n      CREDENTIAL assemblaCredential = getCredential(\"assembla.com\");\r\n      if(assemblaCredential==null){\r\n        throw new BusinessException(\"cannot find any Credential for assembla.com, please create one with username= api-key and header-value=api-secret.\");\r\n      }\r\n      try {\r\n        AssemblaResource api  = AssemblaAPI.create(assemblaCredential.getUSERNAME(), assemblaCredential.getHEADER_VALUE());\r\n        PagedIterator<Milestone> pgIt=api.milestones(project.getRemoteSpaces().get(\"assembla.com\")).getAll();\r\n        \r\n        pgIt.forEach(milestones->{\r\n          for(Milestone assemblaMilestone:milestones){\r\n            MV_TCKTMNG_MILESTONE milestone = getMilestone(assemblaMilestone.getId());\r\n            milestone.setTitle(assemblaMilestone.getTitle());\r\n            milestone.setDescription(assemblaMilestone.getDescription());\r\n            if(assemblaMilestone.getCreatedAt()!=null){\r\n              milestone.setStartDate(assemblaMilestone.getCreatedAt().toInstant());\r\n            }\r\n            if(assemblaMilestone.getDueDate()!=null){\r\n              milestone.setDueDate(assemblaMilestone.getDueDate().atStartOfDay().toInstant(ZoneOffset.UTC));\r\n            }\r\n            if(assemblaMilestone.getCompletedDate()!=null){\r\n              milestone.setEndDate(assemblaMilestone.getCompletedDate().atStartOfDay().toInstant(ZoneOffset.UTC));\r\n            }\r\n            try{\r\n            crossStorageApi.createOrUpdate(repositoryService.findDefaultRepository(), CEIUtils.pojoToCei(milestone));\r\n            } catch (Exception e){\r\n              throw new RuntimeException(\"Exception while persisting milestone\",e);\r\n            }\r\n          };\r\n        });\r\n      } catch (Exception e){\r\n        throw new BusinessException(\"Exception while retrieving assembla tickets\",e);\r\n      }\r\n    }\r\n\r\n    @Override\r\n    public void execute(Map<String,Object> params)  throws BusinessException {\r\n        CustomEntityInstance cei = (CustomEntityInstance)params.get(\"CONTEXT_ENTITY\");\r\n        MV_TCKTMNG_PROJECT project = CEIUtils.ceiToPojo(cei, MV_TCKTMNG_PROJECT.class);\r\n        for(String domain:project.getRemoteSpaces().keySet()){\r\n          if(\"assembla.com\".equals(domain)){\r\n            retrieveAssemblaTickets(project);\r\n          }\r\n        }\r\n      \tlog.info(\"project:{}\",project);\r\n    }\r\n\r\n\r\n}",
      "executionRoles" : [ ],
      "sourcingRoles" : [ ],
      "mavenDependencies" : [ {
        "groupId" : "com.assembla",
        "artifactId" : "assembla-api",
        "version" : "0.1",
        "coordinates" : "com.assembla:assembla-api:0.1"
      } ],
      "importScriptInstances" : [ ]
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.ScriptInstanceDto",
    "dtoData" : {
      "active" : true,
      "code" : "org.meveo.ticket_management.TicketManagementInstallScript",
      "inputs" : [ ],
      "outputs" : [ ],
      "generateOutputs" : false,
      "type" : "JAVA",
      "transactionType" : "SAME",
      "script" : "package org.meveo.ticket_management;\r\n\r\nimport java.io.File;\r\nimport java.io.FileOutputStream;\r\nimport java.io.InputStream;\r\nimport java.io.OutputStream;\r\nimport java.util.Map;\r\n\r\nimport javax.ws.rs.client.Client;\r\nimport javax.ws.rs.client.ClientBuilder;\r\nimport javax.ws.rs.client.WebTarget;\r\nimport javax.ws.rs.core.Response;\r\n\r\nimport org.meveo.admin.exception.BusinessException;\r\nimport org.meveo.service.config.impl.MavenConfigurationService;\r\nimport org.meveo.service.script.module.ModuleScript;\r\n\r\npublic class TicketManagementInstallScript extends ModuleScript {\r\n    \r\n    static final String REPO_NAME=\"smichea\";\r\n    static final String GROUP_ID=\"com.assembla\";\r\n    static final String ARTIFACT_ID=\"assembla-api\";\r\n    static final String VERSION=\"0.1\";\r\n    static final String CLASSIFIER=\"\";\r\n    static final String FILENAME = \"assembla-api-0.1.jar\";\r\n\r\n    MavenConfigurationService mavenConfigurationService = getCDIBean(MavenConfigurationService.class);\r\n\r\n    protected InputStream  downloadJar(){\r\n        Client client = ClientBuilder.newClient();\r\n        WebTarget webTarget = client.target(\"https://github.com/\"+REPO_NAME+\"/\"+ARTIFACT_ID+\"/releases/download/v\"+VERSION+\"/\"+FILENAME);\r\n        Response response = webTarget.request().get();\r\n        if(response.getStatus()==302){\r\n            String location = response.getHeaderString(\"Location\");\r\n            response = client.target(location).request().get();\r\n        }\r\n        if(response.getStatus()==200){\r\n            InputStream in = response.readEntity(InputStream.class);\r\n            return in;\r\n        }\r\n        return null;\r\n    }\r\n\r\n    protected void uploadMavenArtifact(InputStream inputStream, File file) throws BusinessException{\r\n\t\ttry {\r\n\t\t\tOutputStream outputStream = new FileOutputStream(file);\r\n\t\t\tint read = 0;\r\n\t\t\tbyte[] data = new byte[1024];\r\n\r\n\t\t\twhile ((read = inputStream.read(data)) != -1) {\r\n\t\t\t\toutputStream.write(data, 0, read);\r\n\t\t\t}\r\n\r\n\t\t\tinputStream.close();\r\n\t\t\toutputStream.flush();\r\n\t\t\toutputStream.close();\r\n\r\n\t\t} catch (Exception e) {\r\n\t\t\tthrow new BusinessException(\"Error uploading file: \" + FILENAME + \". \" + e.getMessage());\r\n\t\t}\r\n\t}\r\n    \r\n    protected boolean artifactExist(){\r\n        boolean result=false;\r\n        return result;\r\n    }\r\n\r\n    protected void updloadArtifact() throws BusinessException{\r\n        String filePath = mavenConfigurationService.createDirectory(GROUP_ID, ARTIFACT_ID, VERSION, CLASSIFIER);\r\n\t\tfilePath = filePath + File.separator + mavenConfigurationService.buildArtifactName(ARTIFACT_ID, VERSION, CLASSIFIER);\r\n        File file =new File(filePath);\r\n        if(!file.exists()){\r\n            InputStream in = downloadJar();\r\n            uploadMavenArtifact(in,file);\r\n        }\r\n    }\r\n\r\n    public void preInstallModule(Map<String, Object> methodContext) throws BusinessException {\r\n        updloadArtifact();\r\n    }\r\n\r\n    public void execute(Map<String, Object> methodContext) throws BusinessException {\r\n        updloadArtifact();\r\n    }\r\n}\r\n",
      "executionRoles" : [ ],
      "sourcingRoles" : [ ],
      "mavenDependencies" : [ ],
      "importScriptInstances" : [ ]
    }
  }, {
    "dtoClassName" : "org.meveo.api.dto.EntityCustomActionDto",
    "dtoData" : {
      "code" : "RETRIEVE_REMOTE_TICKETS",
      "description" : "retreive tickets from remote spaces",
      "appliesTo" : "CE_MV_TCKTMNG_PROJECT",
      "label" : "Retrieve tickets",
      "script" : "org.meveo.ticket_management.RetrieveRemoteTicketsScript",
      "applicableToEntityList" : false,
      "applicableToEntityInstance" : true
    }
  } ],
  "moduleDependencies" : [ {
    "code" : "CREDENTIALS",
    "description" : "credentials",
    "currentVersion" : "1.0.0"
  } ],
  "moduleFiles" : [ ]
} ]